---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xishan.
--- DateTime: 2024/4/21 21:14
---
local key = KEYS[1]
local exists = redis.call('EXISTS', key)
if exists == 0 then
    return 0
end

local oldRating = tonumber(ARGV[1])
local newRating = tonumber(ARGV[2])
local currentValues = redis.call('HMGET', key, 'score', 'rater_cnt')

local currentScore = tonumber(currentValues[1])
local currentCount = tonumber(currentValues[2])

local newScore = ((currentScore * currentCount) - oldRating + newRating) / currentCount
redis.call('HSET', key, 'score', newScore)
return 1